<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>XML 型プロバイダー
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="FSharp.Data">

    <link rel="stylesheet" id="theme_link" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.3.1/materia/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/navbar-fixed-left.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdocs-default.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdocs-custom.css" />
    <script type="text/javascript" src="/FSharp.Data/content/fsdocs-tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- BEGIN SEARCH BOX: this adds support for the search box -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
    <!-- END SEARCH BOX: this adds support for the search box -->
    
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-light bg-secondary fixed-left" id="fsdocs-nav">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <a href="/FSharp.Data/"><img id="fsdocs-logo" src="/FSharp.Data/img/logo.png" /></a>
            <!-- BEGIN SEARCH BOX: this adds support for the search box -->
            <div id="header">
                <div class="searchbox" id="fsdocs-searchbox">
                    <label for="search-by">
                        <i class="fas fa-search"></i>
                    </label>
                    <input data-search-input="" id="search-by" type="search" placeholder="Search..." />
                    <span data-search-clear="">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
            </div>

            <!-- END SEARCH BOX: this adds support for the search box -->
            <ul class="navbar-nav">
                <li class="nav-header">Links</li>
                <li class="nav-item" id="fsdocs-license-link"><a class="nav-link" href="{{fsdocs-license-link}}">License (Apache 2.0)</a></li>
                <li class="nav-item" id="fsdocs-release-notes-link"><a class="nav-link" href="{{fsdocs-release-notes-link}}">Release Notes</a></li>
                <li class="nav-item" id="fsdocs-repository-link"><a class="nav-link" href="{{fsdocs-repository-link}}">Source Repository</a></li>
                <li class="nav-header">
  Documentation
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/CsvFile.html">
    CSV Parser

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/CsvProvider.html">
    CSV Type Provider

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/HtmlCssSelectors.html">
    HTML CSS selectors

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/HtmlParser.html">
    HTML Parser

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/HtmlProvider.html">
    HTML Type Provider

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/Http.html">
    HTTP Utilities

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/JsonProvider.html">
    JSON Type Provider

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/JsonValue.html">
    JSON Parser

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/WorldBank.html">
    WorldBank Provider

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/library/XmlProvider.html">
    XML Type Provider

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/tutorials/JsonAnonymizer.html">
    Anonymizing JSON

  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/tutorials/JsonToXml.html">
    Converting between JSON and XML

  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="/FSharp.Data/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="masthead">
            <h3 class="muted"><a href="/FSharp.Data/">FSharp.Data</a></h3>
        </div>
        <hr />
        <div class="container" id="fsdocs-content">
            <h1><a name="XML-型プロバイダー" class="anchor" href="#XML-型プロバイダー">XML 型プロバイダー</a></h1>
<p>このドキュメントではXML型プロバイダーを使用して、静的に型付けされた
方法でXMLドキュメントにアクセスする方法について説明します。
まず、XMLドキュメントの構造が推測される方法について説明した後に、
XML型プロバイダーを使用してRSSフィードを解析するデモを紹介します。</p>
<p>ML型プロバイダーを使用すると、静的に型付けされた方法でXMLドキュメントに
アクセスできます。
このプロバイダーはサンプルとなるドキュメントを入力として受け取ります
(あるいはサンプルとして使用されるような複数の子ノードを持った
ルートXMLノードを含むドキュメントを受け取ります)。
そして生成された型を使用すると、サンプルドキュメントと同じ構造のファイルを
読み取ることができるようになります。
ファイルの構造がサンプルと異なる場合には実行時エラーが発生します
(ただし存在しない要素にアクセスしようとした場合に限られます)。</p>
<h2><a name="プロバイダーの基本" class="anchor" href="#プロバイダーの基本">プロバイダーの基本</a></h2>
<p>型プロバイダーは <code>FSharp.Data.dll</code> アセンブリ内にあります。
このアセンブリが <code>../../../../bin</code> ディレクトリにあると仮定すると、
F# Interactive内で読み込むためには以下のようにします
(なおこの型プロバイダーは内部で <code>XDocument</code> を使用しているため、
<code>System.Xml.Linq</code> への参照も必要になる点に注意してください)：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="pp">#r</span> <span class="s">&quot;System.Xml.Linq.dll&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">Data</span>
</code></pre>
<h3><a name="サンプルからの型の推論" class="anchor" href="#サンプルからの型の推論">サンプルからの型の推論</a></h3>
<p><code>XmlProvider&lt;...&gt;</code> には <code>string</code> 型の静的パラメータを1つ指定します。
このパラメータには <strong>サンプルとなるXML文字列</strong> または
<strong>サンプルファイル</strong> のいずれかを指定します
(カレントディレクトリからの相対パスか、 <strong>http</strong> または <strong>https</strong> 経由で
アクセス可能なファイル名を指定します)。
パラメータの値があいまいで認識できないようなケースはほとんど無いでしょう。</p>
<p>以下のサンプルではルートノードに2つの属性を持ったXMLドキュメントを
読み取ることができるような型を生成しています：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="rt">Author</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;&quot;&quot;&lt;author name=&quot;Paul Feyerabend&quot; born=&quot;1924&quot; /&gt;&quot;&quot;&quot;</span><span class="pn">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="id">sample</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="id">Author</span><span class="pn">.</span><span class="id">Parse</span><span class="pn">(</span><span class="s">&quot;&quot;&quot;&lt;author name=&quot;Karl Popper&quot; born=&quot;1902&quot; /&gt;&quot;&quot;&quot;</span><span class="pn">)</span>

<span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%d</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="id">sample</span><span class="pn">.</span><span class="id">Name</span> <span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="id">sample</span><span class="pn">.</span><span class="id">Born</span>
</code></pre>
<p>型プロバイダーによって生成された型 <code>Author</code> には、XMLドキュメントの
ルート要素にある2つの属性と同じ名前のプロパティがあります。
プロパティの型はサンプルとして指定したドキュメントの値から推測されます。
今回の場合、 <code>Name</code> プロパティは <code>string</code> 型で
<code>Born</code> プロパティは <code>int</code> 型です。</p>
<p>XMLは非常に柔軟な形式なので、同じドキュメントを異なる形式で表現できます。
具体的には属性を使用する代わりに、値を直接含むようなネストされたノードとして
表現できます( <code>&lt;author&gt;</code> 以下に <code>&lt;name&gt;</code> および <code>&lt;born&gt;</code> をネストさせます)</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="rt">AuthorAlt</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;&lt;author&gt;&lt;name&gt;Karl Popper&lt;/name&gt;&lt;born&gt;1902&lt;/born&gt;&lt;/author&gt;&quot;</span><span class="pn">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 10)" onmouseover="showTip(event, 'fs7', 10)" class="id">doc</span> <span class="o">=</span> <span class="s">&quot;&lt;author&gt;&lt;name&gt;Paul Feyerabend&lt;/name&gt;&lt;born&gt;1924&lt;/born&gt;&lt;/author&gt;&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="id">sampleAlt</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 12)" onmouseover="showTip(event, 'fs6', 12)" class="id">AuthorAlt</span><span class="pn">.</span><span class="id">Parse</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="id">doc</span><span class="pn">)</span>

<span onmouseout="hideTip(event, 'fs5', 14)" onmouseover="showTip(event, 'fs5', 14)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%d</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="id">sampleAlt</span><span class="pn">.</span><span class="id">Name</span> <span onmouseout="hideTip(event, 'fs8', 16)" onmouseover="showTip(event, 'fs8', 16)" class="id">sampleAlt</span><span class="pn">.</span><span class="id">Born</span>
</code></pre>
<p>生成された型を使用すると、同じ形式のドキュメントを読み取る場合には完全に同じAPIで
アクセスできるようになります（ただし1番目の形式を使用するサンプルを <code>AuthorAlt</code>
で解析することはできません。両者は単にpublic APIの形式が同じだけであって、
型の実装としてはそれぞれ別のものだからです）。</p>
<p>この型プロバイダーはノードにプリミティブな値だけが含まれていて、子ノードも属性も
持たないような場合に限って、ノードを単純に型付けされたプロパティへと変換します。</p>
<h3><a name="さらに複雑な構造を持つドキュメントに対する型" class="anchor" href="#さらに複雑な構造を持つドキュメントに対する型">さらに複雑な構造を持つドキュメントに対する型</a></h3>
<p>もう少し興味深い構造を持った例をいくつか見ていくことにしましょう。
まず、ノードが同じ値を持つものの、属性の値が異なる場合にはどうなるでしょうか？</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="rt">Detailed</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;&quot;&quot;&lt;author&gt;&lt;name full=&quot;true&quot;&gt;Karl Popper&lt;/name&gt;&lt;/author&gt;&quot;&quot;&quot;</span><span class="pn">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="id">info</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 19)" onmouseover="showTip(event, 'fs9', 19)" class="id">Detailed</span><span class="pn">.</span><span class="id">Parse</span><span class="pn">(</span><span class="s">&quot;&quot;&quot;&lt;author&gt;&lt;name full=&quot;false&quot;&gt;Thomas Kuhn&lt;/name&gt;&lt;/author&gt;&quot;&quot;&quot;</span><span class="pn">)</span>

<span onmouseout="hideTip(event, 'fs5', 20)" onmouseover="showTip(event, 'fs5', 20)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s"> (full=</span><span class="pf">%b</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs10', 21)" onmouseover="showTip(event, 'fs10', 21)" class="id">info</span><span class="pn">.</span><span class="id">Name</span><span class="pn">.</span><span class="id">Value</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="id">info</span><span class="pn">.</span><span class="id">Name</span><span class="pn">.</span><span class="id">Full</span>
</code></pre>
<p>ノードが( <code>string</code> のような)単純型として表現できない場合、
この型プロバイダーは複数のプロパティを持つような型を新しく作成します。
今回の場合、(属性の名前を元にして) <code>Full</code> というbool型のプロパティが生成されます。
次に要素のコンテンツを返すような、<code>Value</code> という(特別な)名前のプロパティが
追加されます。</p>
<h3><a name="単純な要素を複数持つドキュメントに対する型" class="anchor" href="#単純な要素を複数持つドキュメントに対する型">単純な要素を複数持つドキュメントに対する型</a></h3>
<p>もう1つ興味深い例として、プリミティブ値しか持たないような複数のノードが存在する
場合を考えてみましょう。
以下の例ではルートノード以下に複数の <code>&lt;value&gt;</code> ノードがあるドキュメントを
サンプルとして指定しています( <code>Parse</code> メソッドにパラメータを指定しなかった場合、
スキーマ用に指定したものと同じテキストが実行時の値に反映されます)。</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs11', 23)" onmouseover="showTip(event, 'fs11', 23)" class="rt">Test</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;&lt;root&gt;&lt;value&gt;1&lt;/value&gt;&lt;value&gt;3&lt;/value&gt;&lt;/root&gt;&quot;</span><span class="pn">&gt;</span>

<span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="id">Test</span><span class="pn">.</span><span class="id">GetSample</span><span class="pn">(</span><span class="pn">)</span><span class="pn">.</span><span class="id">Values</span>
<span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 25)" onmouseover="showTip(event, 'fs12', 25)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs13', 26)" onmouseover="showTip(event, 'fs13', 26)" class="id">iter</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs5', 27)" onmouseover="showTip(event, 'fs5', 27)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%d</span><span class="s">&quot;</span><span class="pn">)</span>
</code></pre>
<p>型パラメータは複数の値を配列として返すような <code>Values</code> メソッドを生成します。
<code>&lt;value&gt;</code> ノードは任意個の属性や子ノードを持つわけではないため、
それぞれ <code>int</code> 値となり、 <code>Values</code> メソッドも単に <code>int[]</code> を返すようになります！</p>
<h2><a name="哲学者たちをもてなす" class="anchor" href="#哲学者たちをもてなす">哲学者たちをもてなす</a></h2>
<p>このセクションでは特定の話題に関する著者のリストを含んだ、単純なドキュメントを
型プロバイダーで処理する方法についてのデモを紹介します。
サンプルとなるドキュメント <a href="../../data/Writers.xml"><code>data/Writers.xml</code></a> は
以下のようになっています：</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">authors</span> <span class="o">topic</span><span class="k">="Philosophy of Science"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">author</span> <span class="o">name</span><span class="k">="Paul Feyerabend"</span> <span class="o">born</span><span class="k">="1924"</span> <span class="k">/&gt;</span>
  <span class="k">&lt;</span><span class="i">author</span> <span class="o">name</span><span class="k">="Thomas Kuhn"</span> <span class="k">/&gt;</span>
<span class="k">&lt;/</span><span class="i">authors</span><span class="k">&gt;</span> 
</code></pre></td></tr></table>
<p>実行時には型プロバイダーから生成された型を使用して、以下のような文字列を
解析します(構造としてはサンプルのドキュメントと同じですが、
<code>author</code> ノードに <code>died</code> 属性が含まれているという違いがあります)：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="id">authors</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">  &lt;authors topic=&quot;Philosophy of Mathematics&quot;&gt;</span>
<span class="s">    &lt;author name=&quot;Bertrand Russell&quot; /&gt;</span>
<span class="s">    &lt;author name=&quot;Ludwig Wittgenstein&quot; born=&quot;1889&quot; /&gt;</span>
<span class="s">    &lt;author name=&quot;Alfred North Whitehead&quot; died=&quot;1947&quot; /&gt;</span>
<span class="s">  &lt;/authors&gt; &quot;&quot;&quot;</span>
</code></pre>
<p><code>XmlProvider</code> の初期化時にはファイル名またはWebのURLを指定できます。
<code>Load</code> や <code>AsyncLoad</code> メソッドを使用すると、
ファイルあるいはWeb上のリソースを読み取ることができます。
<code>Parse</code> メソッドの場合はデータとして文字列を指定できるため、以下のようにすると
データ内の情報を表示することができます：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs15', 29)" onmouseover="showTip(event, 'fs15', 29)" class="rt">Authors</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;../../data/Writers.xml&quot;</span><span class="pn">,</span> <span class="id">ResolutionFolder</span><span class="o">=</span><span class="k">__SOURCE_DIRECTORY__</span><span class="pn">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="id">topic</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 31)" onmouseover="showTip(event, 'fs15', 31)" class="id">Authors</span><span class="pn">.</span><span class="id">Parse</span><span class="pn">(</span><span onmouseout="hideTip(event, 'fs14', 32)" onmouseover="showTip(event, 'fs14', 32)" class="id">authors</span><span class="pn">)</span>

<span onmouseout="hideTip(event, 'fs5', 33)" onmouseover="showTip(event, 'fs5', 33)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs16', 34)" onmouseover="showTip(event, 'fs16', 34)" class="id">topic</span><span class="pn">.</span><span class="id">Topic</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs17', 35)" onmouseover="showTip(event, 'fs17', 35)" class="fn">author</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs16', 36)" onmouseover="showTip(event, 'fs16', 36)" class="id">topic</span><span class="pn">.</span><span class="id">Authors</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs18', 37)" onmouseover="showTip(event, 'fs18', 37)" class="fn">printf</span> <span class="s">&quot; - </span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs17', 38)" onmouseover="showTip(event, 'fs17', 38)" class="fn">author</span><span class="pn">.</span><span class="id">Name</span> 
  <span onmouseout="hideTip(event, 'fs17', 39)" onmouseover="showTip(event, 'fs17', 39)" class="fn">author</span><span class="pn">.</span><span class="id">Born</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 40)" onmouseover="showTip(event, 'fs19', 40)" class="m">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 41)" onmouseover="showTip(event, 'fs20', 41)" class="id">iter</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs18', 42)" onmouseover="showTip(event, 'fs18', 42)" class="fn">printf</span> <span class="s">&quot; (</span><span class="pf">%d</span><span class="s">)&quot;</span><span class="pn">)</span>
  <span onmouseout="hideTip(event, 'fs5', 43)" onmouseover="showTip(event, 'fs5', 43)" class="fn">printfn</span> <span class="s">&quot;&quot;</span>
</code></pre>
<p>値 <code>topic</code> には( <code>string</code> 型の) <code>Topic</code> プロパティがあります。
このプロパティは同名の属性の値を返します。
また、すべての著者名をコレクションとして返すような <code>Authors</code> メソッドもあります。
<code>Born</code> プロパティはいくつかの著者では指定されていないため、
<code>option&lt;int&gt;</code> 型として定義されています。
そのため、 <code>Option.iter</code> を使用して表示する必要があります。</p>
<p><code>died</code> 属性はサンプルからの推論時には存在しないため、
静的に型付けられた方法でこの値を取得することはできません
(ただし <code>author.XElement.Attribute(XName.Get("died"))</code> というコードを使用して
動的に取得することは可能です)。</p>
<h2><a name="グローバル推測モード" class="anchor" href="#グローバル推測モード">グローバル推測モード</a></h2>
<p>これまでの例では、同じ名前の要素を（再帰的に）含むような要素は
出てきませんでした(つまりたとえば <code>&lt;author&gt;</code> 以下に <code>&lt;author&gt;</code> ノードは
決して現れないということです)。
しかしXHTMLファイルのようなドキュメントを扱う場合、こういった状況はよくあることです。
例として以下のようなサンプルドキュメントがあるとしましょう
(単純化したバージョンが <a href="../../data/HtmlBody.xml"><code>data/HtmlBody.xml</code></a> にあります)：</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">div</span> <span class="o">id</span><span class="k">="root"</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">span</span><span class="k">&gt;</span>Main text<span class="k">&lt;/</span><span class="i">span</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">div</span> <span class="o">id</span><span class="k">="first"</span><span class="k">&gt;</span>
    <span class="k">&lt;</span><span class="i">div</span><span class="k">&gt;</span>Second text<span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
  <span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
<span class="k">&lt;/</span><span class="i">div</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<p>この例では <code>&lt;div&gt;</code> 要素内に <code>&lt;div&gt;</code> 要素がありますが、いずれも同じ型として
扱われるべきであることは明らかです。
<code>&lt;div&gt;</code> 要素を処理する再帰関数を作成できるようになっていてもらいたいはずです。
このような場合には引数 <code>Global</code> に <code>true</code> を指定します：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs21', 44)" onmouseover="showTip(event, 'fs21', 44)" class="rt">Html</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;../../data/HtmlBody.xml&quot;</span><span class="pn">,</span> <span class="id">Global</span><span class="o">=</span><span class="k">true</span><span class="pn">,</span> <span class="id">ResolutionFolder</span><span class="o">=</span><span class="k">__SOURCE_DIRECTORY__</span><span class="pn">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 45)" onmouseover="showTip(event, 'fs22', 45)" class="id">html</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 46)" onmouseover="showTip(event, 'fs21', 46)" class="id">Html</span><span class="pn">.</span><span class="id">GetSample</span><span class="pn">(</span><span class="pn">)</span>
</code></pre>
<p>引数 <code>Global</code> を <code>true</code> にすると、型プロバイダーは同名の要素すべてを <strong>一元化</strong> します。
つまりすべての <code>&lt;div&gt;</code> 要素が同じ型として扱われることになります
( <code>&lt;div&gt;</code> に指定されたすべての属性をプロパティとして持ち、
サンプルドキュメント内で見つけられるすべての子要素の組み合わせが考慮されます)。</p>
<p>型は <code>Html</code> 以下に定義されます。
したがって、<code>Html.Div</code> を引数にとり、
各 <code>&lt;div&gt;</code> 要素を処理するような <code>printDiv</code> 関数を以下のようにして作成できます：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// &lt;div&gt; 要素のコンテンツを表示します</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs23', 47)" onmouseover="showTip(event, 'fs23', 47)" class="fn">printDiv</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs24', 48)" onmouseover="showTip(event, 'fs24', 48)" class="fn">div</span><span class="pn">:</span><span onmouseout="hideTip(event, 'fs21', 49)" onmouseover="showTip(event, 'fs21', 49)" class="id">Html</span><span class="pn">.</span><span class="id">Div</span><span class="pn">)</span> <span class="o">=</span>
  <span onmouseout="hideTip(event, 'fs24', 50)" onmouseover="showTip(event, 'fs24', 50)" class="fn">div</span><span class="pn">.</span><span class="id">Spans</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 51)" onmouseover="showTip(event, 'fs12', 51)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs13', 52)" onmouseover="showTip(event, 'fs13', 52)" class="id">iter</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs5', 53)" onmouseover="showTip(event, 'fs5', 53)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span><span class="pn">)</span>
  <span onmouseout="hideTip(event, 'fs24', 54)" onmouseover="showTip(event, 'fs24', 54)" class="fn">div</span><span class="pn">.</span><span class="id">Divs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 55)" onmouseover="showTip(event, 'fs12', 55)" class="m">Seq</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs13', 56)" onmouseover="showTip(event, 'fs13', 56)" class="id">iter</span> <span onmouseout="hideTip(event, 'fs23', 57)" onmouseover="showTip(event, 'fs23', 57)" class="fn">printDiv</span>
  <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 58)" onmouseover="showTip(event, 'fs24', 58)" class="fn">div</span><span class="pn">.</span><span class="id">Spans</span><span class="pn">.</span><span class="id">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="fn">div</span><span class="pn">.</span><span class="id">Divs</span><span class="pn">.</span><span class="id">Length</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span>
      <span onmouseout="hideTip(event, 'fs24', 60)" onmouseover="showTip(event, 'fs24', 60)" class="fn">div</span><span class="pn">.</span><span class="id">Value</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs19', 61)" onmouseover="showTip(event, 'fs19', 61)" class="m">Option</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs20', 62)" onmouseover="showTip(event, 'fs20', 62)" class="id">iter</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs5', 63)" onmouseover="showTip(event, 'fs5', 63)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span><span class="pn">)</span>

<span class="c">// すべての子要素と共にルートの &lt;div&gt; 要素を表示します</span>
<span onmouseout="hideTip(event, 'fs23', 64)" onmouseover="showTip(event, 'fs23', 64)" class="fn">printDiv</span> <span onmouseout="hideTip(event, 'fs22', 65)" onmouseover="showTip(event, 'fs22', 65)" class="id">html</span>
</code></pre>
<p>この関数はまず <code>&lt;span&gt;</code> 内のすべてのテキストを表示します
(今回の例の場合、属性が全く指定されていないため、
<code>string</code> 型として推論されます)。
次に、すべての <code>&lt;div&gt;</code> 要素を再帰的に表示します。
ネストされた要素が見つからない場合は <code>Value</code> (インナーテキスト)を表示します。</p>
<h2><a name="RSSフィードの読み取り" class="anchor" href="#RSSフィードの読み取り">RSSフィードの読み取り</a></h2>
<p>今回の総まとめとして、もう少し実用的な例としてRSSフィードを解析してみましょう。
既に説明した通り、型プロバイダーには相対パスあるいはWebページのアドレスを指定できます：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs25', 66)" onmouseover="showTip(event, 'fs25', 66)" class="rt">Rss</span> <span class="o">=</span> <span class="id">XmlProvider</span><span class="pn">&lt;</span><span class="s">&quot;http://tomasp.net/rss.xml&quot;</span><span class="pn">&gt;</span>
</code></pre>
<p>このコードではRSSフィード（および <code>http://tomasp.net</code> で使用されている機能）
を表す <code>Rss</code> 型を生成しています。
<code>Rss</code> 型にはこの型のインスタンスを生成するための機能として、staticメソッド
<code>Parse</code> 、 <code>Load</code> 、 <code>AsyncLoad</code> が定義されています。
今回の場合、スキーマとして指定したものと同じURIを再利用したいので、
staticメソッド <code>GetSample</code> を使用します：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 67)" onmouseover="showTip(event, 'fs26', 67)" class="id">blog</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs25', 68)" onmouseover="showTip(event, 'fs25', 68)" class="id">Rss</span><span class="pn">.</span><span class="id">GetSample</span><span class="pn">(</span><span class="pn">)</span>
</code></pre>
<p>ここまで来ればRSSフィードのタイトルと直近の投稿一覧を表示することは簡単です。
単に <code>blog</code> に続けて <code>.</code> と入力すれば、自動補完の候補一覧が確認できるでしょう。
コードとしては以下のようにします：</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Title は文字列を返すプロパティです</span>
<span onmouseout="hideTip(event, 'fs5', 69)" onmouseover="showTip(event, 'fs5', 69)" class="fn">printfn</span> <span class="s">&quot;</span><span class="pf">%s</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs26', 70)" onmouseover="showTip(event, 'fs26', 70)" class="id">blog</span><span class="pn">.</span><span class="id">Channel</span><span class="pn">.</span><span class="id">Title</span>

<span class="c">// すべてのitemノードを取得して、それぞれのタイトルとリンクを表示します</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs27', 71)" onmouseover="showTip(event, 'fs27', 71)" class="fn">item</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs26', 72)" onmouseover="showTip(event, 'fs26', 72)" class="id">blog</span><span class="pn">.</span><span class="id">Channel</span><span class="pn">.</span><span class="id">Items</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs5', 73)" onmouseover="showTip(event, 'fs5', 73)" class="fn">printfn</span> <span class="s">&quot; - </span><span class="pf">%s</span><span class="s"> (</span><span class="pf">%s</span><span class="s">)&quot;</span> <span onmouseout="hideTip(event, 'fs27', 74)" onmouseover="showTip(event, 'fs27', 74)" class="fn">item</span><span class="pn">.</span><span class="id">Title</span> <span onmouseout="hideTip(event, 'fs27', 75)" onmouseover="showTip(event, 'fs27', 75)" class="fn">item</span><span class="pn">.</span><span class="id">Link</span>
</code></pre>
<h2><a name="関連する記事" class="anchor" href="#関連する記事">関連する記事</a></h2>
<ul>
<li><a href="../..reference/fsharp-data-xmlprovider.html">API リファレンス: XmlProvider 型プロバイダー</a></li>
<li><a href="../../reference/fsharp-data-xelementextensions.html">API リファレンス: XElementExtensions モジュール</a></li>
</ul>

            <div class="fsdocs-tip" id="fs1">namespace Microsoft.FSharp</div>
<div class="fsdocs-tip" id="fs2">namespace Microsoft.FSharp.Data</div>
<div class="fsdocs-tip" id="fs3">type Author = obj</div>
<div class="fsdocs-tip" id="fs4">val sample : obj</div>
<div class="fsdocs-tip" id="fs5">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs6">type AuthorAlt = obj</div>
<div class="fsdocs-tip" id="fs7">val doc : string</div>
<div class="fsdocs-tip" id="fs8">val sampleAlt : obj</div>
<div class="fsdocs-tip" id="fs9">type Detailed = obj</div>
<div class="fsdocs-tip" id="fs10">val info : obj</div>
<div class="fsdocs-tip" id="fs11">type Test = obj</div>
<div class="fsdocs-tip" id="fs12">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="fsdocs-tip" id="fs13">val iter : action:(&#39;T -&gt; unit) -&gt; source:seq&lt;&#39;T&gt; -&gt; unit</div>
<div class="fsdocs-tip" id="fs14">val authors : string</div>
<div class="fsdocs-tip" id="fs15">type Authors = obj</div>
<div class="fsdocs-tip" id="fs16">val topic : obj</div>
<div class="fsdocs-tip" id="fs17">val author : obj</div>
<div class="fsdocs-tip" id="fs18">val printf : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs19">module Option<br /><br />from Microsoft.FSharp.Core</div>
<div class="fsdocs-tip" id="fs20">val iter : action:(&#39;T -&gt; unit) -&gt; option:&#39;T option -&gt; unit</div>
<div class="fsdocs-tip" id="fs21">type Html = obj</div>
<div class="fsdocs-tip" id="fs22">val html : obj</div>
<div class="fsdocs-tip" id="fs23">val printDiv : div:&#39;a -&gt; unit</div>
<div class="fsdocs-tip" id="fs24">val div : &#39;a</div>
<div class="fsdocs-tip" id="fs25">type Rss = obj</div>
<div class="fsdocs-tip" id="fs26">val blog : obj</div>
<div class="fsdocs-tip" id="fs27">val item : obj</div>

        </div>

        <!-- BEGIN SEARCH BOX: this adds support for the search box -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
        <script type="text/javascript">var fsdocs_search_baseurl = '/FSharp.Data/';</script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
        <script type="text/javascript" src="/FSharp.Data/content/fsdocs-search.js"></script>
        <!-- END SEARCH BOX: this adds support for the search box -->
    </div>
</body>

</html>

